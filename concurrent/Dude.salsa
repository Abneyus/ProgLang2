module concurrent;

import java.io.*;
import java.util.*;

behavior Dude{
  int id;
  String host;
  int port;
  int priority;
  int maxTolerance;
  int tolerance;

  boolean active;
  boolean revolted;
  boolean passive;
  boolean pastLeader;

  Dude left;
  Dude right;

  Dude(int id, String host, int port, int priority, int tolerance, Dude left, Dude right) {
    this.id = id;
    this.host = host;
    this.port = port;
    this.priority = priority;
    this.maxTolerance = tolerance;
    this.tolerance = 0;

    this.active = true;
    this.revolted = false;
    this.passive = false;
    this.pastLeader = false;

    this.left = left;
    this.right = right;
  }

  void campaign()
  {
    if(!pastLeader)
    {
      this.left <- consider(this.id, this.priority, true);
    }
  }

  void consider(int candidate, int canditatePriority, boolean leader)
  {
    if(candidate == this.id && leader)
    {
      elect();
    }
    else
    {
      if(canditatePriority > this.priority)
      {
        this.left <- consider(candidate, canditatePriority, true);
      }
      else if(!pastLeader)
      {
        this.left <- consider(candidate, canditatePriority, false);
      }
      else
      {
        this.left <- consider(candidate, canditatePriority, true);
      }
    }
  }

  void elect()
  {
    pastLeader = true;
    standardOutput <- println("Node: " + id + " elected.");
  }


//ACCESSORS
  int getID() {
    return id;
  }
  String getHost() {
    return host;
  }
  int getPort() {
    return port;
  }
  int getTolerance() {
    return tolerance;
  }
  int getMaxTolerance() {
    return maxTolerance;
  }
  boolean getInactive() {
    return active;
  }
  boolean getRevolted() {
    return revolted;
  }

//SETTERS
  void setRevolted(boolean b) {
    revolted = b;
  }

  void setLeft(Dude left)
  {
    this.left = left;
  }

  void setRight(Dude right)
  {
    this.right = right;
  }
  void setPastLeader(boolean b) {
    pastLeader=b;
  }

}
